# 全文索引

### 提示

>   -   只有Innodb和myisam存储引擎能用全文索引（innodb支持全文索引是从mysql5.6开始的）
>   -   char、varchar、text类型字段能创建全文索引（fulltext index type）
>   -   全文索引的基于关键词的，如何区分不同的关键词了，就要用到分词（stopword）
>   -   英文单词用空格，逗号进行分词；中文分词不方便（一个句子不知道怎样区分不同的关键词）
>   -   内置分词解析器**ngram**支持中文，日文，韩文（将句子分成固定数字的短语）
>   -   当对表写入大量数据时，写入数据后再创建全文索引的速度更快（减少了维护索引的开销）
>   -   全文索引的原理的倒排索引（一种数据结构），一般利用关联数组，在辅助表中存储单词与文档中所在位置的映射



### 相关参数

>   **配置相关参数**
>   innodb_ft_min_token_size
>   默认3，表示最小3个字符作为一个关键词，增大该值可减少全文索引的大小
>
>   innodb_ft_max_token_size
>   默认84，表示最大84个字符作为一个关键词，限制该值可减少全文索引的大小
>
>   ngram_token_size
>   默认2，表示2个字符作为内置分词解析器的一个关键词，如对“abcd”建立全文索引，关键词为'ab'，'bc'，'cd'
>   当使用ngram分词解析器时，innodb_ft_min_token_size和innodb_ft_max_token_size 无效
>
>   **注意** 这三个参数均**不可动态修改**，修改了这些参数，需重启MySQL服务，并**重新建立全文索引**



### 三种类型的全文搜索模式

```mysql
-- （自然语言搜索）
in natural language mode
-- 通过MATCH AGAINST 传递某个特定的字符串来进行检，默认方式

-- （布尔搜索）
in boolean mode
-- 为检索的字符串增加操作符，如“+”表示必须包含，"-"不包含，"*" 表示通配符，即使传递的字符串较小或出现在停词中，也不会被过滤掉

-- （查询扩展搜索）
with query expansion
-- 搜索字符串用于执行自然语言搜索，然后，搜索返回的最相关行的单词被添加到搜索字符串，并且再次进行搜索，查询将返回来自第二个搜索的行
```



### 使用方法

```mysql
-- MATCH('索引列') AGAINST('酸辣' [搜索模式])
SELECT * FROM `dc_order_info` WHERE MATCH(`store_menu_name`) AGAINST('酸辣' [in boolean mode]);
```



### 创建索引

```mysql
-- 创建表时添加全文索引
create table articles(
     id int auto_increment primary key,
     title varchar(200),
     body text,
     fulltext(title, body) [WITH PARSER NGRAM]
     );
    
-- 通过 alter table 的方式来添加
ALTER TABLE `table_name` ADD FULLTEXT INDEX `索引名`(`column_name`) [WITH PARSER NGRAM];

-- 直接通过create index的方式
CREATE FULLTEXT INDEX `索引名`  ON `table_name` (`column_name`) [WITH PARSER NGRAM];

-- WITH PARSER NGRAM 使用内置分词解析器ngram
```







>参考:
>
>https://www.cnblogs.com/YangJiaXin/p/11153579.html
>
>https://www.yiibai.com/mysql/ngram-full-text-parser.html
>
>https://www.jianshu.com/p/645402711dac
>
>https://www.jianshu.com/p/c48106149b6a
>
>